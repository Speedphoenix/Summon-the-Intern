pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
function _init()

	mode = "start"
	sqrt_inv_2 = 1 / sqrt(2)

		player = {
		sp = 1,
		x = 10,
		y = 10,
		h = 8,
		w = 8,
		dx = 0,
		dy = 0,
		acc = 1,
		fric = .15,
		max_d = 1,
		spd = 2,
		flipx = false
		}
		
		
end



function _update()

	if mode =="game" then update_game()
	elseif mode == "start" then update_start()
	elseif mode == "end" then update_end() end

end



function _draw()

	if mode =="game" then draw_game()
	elseif mode == "start" then draw_start()
	elseif mode == "end" then draw_end() end

	print(mode)
	print(player.flipx)

end
-->8
--  custom function

function update_player()
	ldx = 0
	ldy = 0
	
	local lx=player.x
	local ly=player.y
	

	if btn(⬅️) then ldx -= 1 player.flipx = true end
	if btn(➡️) then ldx += 1 player.flipx = false end
	if btn(⬆️) then ldy -= 1 end
	if btn(⬇️) then ldy += 1 end 		

	if ldx == 0 then
		player.dx *= player.fric
 end
	if ldy == 0 then
		player.dy *= player.fric
	end
	
	if ldx != 0 and ldy != 0 then
		ldx *= sqrt_inv_2
		ldy *= sqrt_inv_2
	end
	
	
	player.dx += ldx * player.acc
	player.dy += ldy * player.acc
		
	-- if btn(⬅️) then player.dx -= player.acc end
	-- if btn(➡️) then player.dx += player.acc end
	-- if btn(⬆️) then player.dy -= player.acc end
	-- if btn(⬇️) then player.dy += player.acc end 		
 
 if abs(player.dx) > player.max_d then
 	if player.dx > 0 then
  	player.dx = player.max_d
  else
   player.dx = player.max_d*-1
 	end
 end
 
 if abs(player.dy) > player.max_d then
 	if player.dy > 0 then
  	player.dy = player.max_d
  else
   player.dy = player.max_d*-1
 	end
 end
 
 player.x += player.dx
 player.y += player.dy
 
     --check collision
    if player.dx>0 then

        if collide_map(player,"right", 0) then
            player.dx=0
            player.x=lx
        end
    end
        
    if player.dx<0 then
        if collide_map(player,"left",0) then
            player.dx=0
            player.x=lx  
        end
    end
    
    if player.dy<0 then
        if collide_map(player,"up",0) then
            player.dy=0
            player.y=ly
        end
    end
    
    if player.dy>0 then
        if collide_map(player,"down",0) then
            player.dy=0
            player.y=ly
        end
    end      

end

function collide_map(obj,aim,flag)

    local x1=0
    local y1=0
    local x2=0
    local y2=0

    local x=obj.x local y=obj.y local w=obj.w local h=obj.h

    if aim=="left" then
        x1=x+1   y1=y+2
        x2=x+2    y2=y+h-3
    elseif aim=="right" then
        x1=x+w-2   y1=y+2
        x2=x+w-1  y2=y+h-3
    elseif aim=="up" then
        x1=x+5    y1=y-1
        x2=x+w-5  y2=y
    elseif aim=="down" then
        x1=x+3      y1=y+h-1
        x2=x+w-4    y2=y+h+obj.dy/4
    end

    --pixel to tiles
    x1=x1/8  x2/=8  y1/=8  y2/=8

    local a= fget(mget(x1,y1), flag) 
    local b= fget(mget(x1,y2), flag) 
    local c= fget(mget(x2,y1), flag) 
    local d= fget(mget(x2,y2), flag)

    if a or b or c or d then
        is_collide=true
        return true
    else
        is_collide=false
        return false
    end


end

function startgame()

	 		player.x = 10
			 player.y = 10

end



-->8
-- update start

function update_start()



 if btnp(❎) or btnp(🅾️) then 
  startgame()  
  mode="game"
 end
 
end
-->8
-- update game

function update_game()



 if btnp(❎) and btnp(🅾️)
 then mode="end" end
 
 update_player()
 
end
-->8
-- update end

function update_end()

 if btnp(❎) or btnp(🅾️)
 then mode="start" end
 
end
-->8
-- draw start

function draw_start()

	cls(3)

end
-->8
-- draw game

function draw_game()

	cls(13)
	map(0,0)
	map(16,0)
	spr(player.sp,player.x,player.y,1,1,player.flipx)
end
-->8
-- draw end

function draw_end()
	cls(8)

end
__gfx__
00000000000999900009999000099990000000000000000000000000000000000000077700000000000000000000000000000000000000000000000000000000
000000000009fc000009fc000009fc00000999900009999000000000000000000000077700000000000000000000000000000000000000000000000000000000
00700700000fff00000fff00000fff000009fc000009fc0000000000000007770000066600000000000000000000000000000000000000000000000000000000
00077000000515000005150000000000000fff00000fff0000000000000007770000077700000000000000000000000000000000000000000000000000000000
00077000000515000005150000051500000515000005150000000000000006660000077700000000000000000000000000000000000000000000000000000000
00700700000555000005550000051500000515000005150000000000000000000000066600000000000000000000000000000000000000000000000000000000
00000000000606000006060000055500000555000005550000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000606000060060000060600000606000060060000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000444400444400000044440000000000000000000000000000000000000000000000000000000000000000007070000070700000707000007070000
000000000004fc0000cf40000004fc00000000000000000000000000000000000000000000000000000000000000000009900000099000000990000009900000
00000000000fff0000fff000000fff00000000000000000000000000000000000000000000000000000000000000000097799000977990009779900097799000
00000000000515000051500000000000000000000000000000000000000000000000000000000000000000000000000009777990097779000977790009777900
00000000000515000051500000051500000000000000000000000000000000000000000000000000000000000000000000999009009990900099909000999090
00000000000555000055500000051500000000000000000000000000000000000000000000000000000000000000000000000009000000090000009000000090
00000000000606000060600000055500000000000000000000000000000000000000000000000000000000000000000000000009000000090000090000000900
00000000000606000060600000060600000000000000000000000000000000000000000000000000000000000000000000000000000000090000090000009000
00000000000000000044400000000000000000000000000000000000000000000000000000000000000000000000000000007070000000000707000000007070
00000040000000000044400000000000000000000000000000000000000000000000000000000000000000000000000000000990000000000990000990000990
000004600000000000fff00000000000000000000000000000000000000000000000000000000000000000000000000000099779000000009779909009099779
00000460000444000055500000000000000000000000000000000000000000000000000000000000000000000000000009977790000000000977790000977790
04444460000cfc000055500000000000000000000000000000000000000000000000000000000000000000000000000090099900000000000099900000099900
04000400000fff000055500000000000000000000000000000000000000000000000000000000000000000000000000090000000000000000000000000000000
04000400000515000060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04000400000f0f000060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00011100000000000000000000000000000000000000000000000000000000000005000000005000000000000077770000000000000000000000000000000000
01115550000111000000000000000000000000000000000005555550055555500056550000556500000000000077770000000000000000000000000000000000
05556650011155500000000000000000000000000000000005666650055555500566665005666650007777000066660000000000000000000000000000000000
05555550055566500000000000000000000000000000000005555550055555500056650000566500007777000077770000000000000000000000000000000000
55555550055555500000000000000000000000000000000000055000000550000005550000555000007777000077770000777700000000000000000000000000
55555550555555500000000000000000000000000000000000000000000000000000550000550000006666000066660000777700000000000000000000000000
00600600555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000777700000000000000000000000000
00600600006006000000000000000000000000000000000000000000000000000000000000000000000000000000000000666600000000000000000000000000
24444444444444444444444414444444000000000333000000001110000000000000000000000000000000000000000000000000155556555565556555565555
24444444444444444444444414444444000000000333000000003330000000000000000000000000000000000000000000000000155556555565556555565556
24444444444444444444444414444444000000000333eee00eee3330044444400000000000000000000000000000000000000000156565555655565555655556
24444444444444444444444414444444000000000111222002223330044444400000000000000000000000000000000000000000165511111111111111115565
24444444444444444444444414444444000000000444422002211110044444400000000000000000000000000000000000000000165500000000000000001555
24444444444444444444444414444444000000000444422002244440044444400000000000000000000000000000000000000000155500000000000000001555
24444444222222224444444414444444000000000444422002244440044444400000000000000000000000000000000000000000155500000000000000001556
24444444005000502444444414444444000000000111100000044440011111100000000000000000000000000000000000000000155500000000000000001556
24444444000000000000000014444444000000000000000000000000000000000000000000000000000000000000000000000000156500000000000000001565
24444444000000000000000014444444000000000000000000000000000000000000000000000000000000000000000000000000156500000000000000001555
24444444000000000000000014444444000000000000000000000000000000000000000000000000000000000000000000000000165500000000000000001565
24444444000000000000000014444444000000000000000000000000000000000000000000000000000000000000000000000000155500000000000000001565
24444444000000000000000014444444000000000000000000000000000000000000000000000000000000000000000000000000155600000000000000001655
24444444000000000000000014444444000000000000000000000000000000000000000000000000000000000000000000000000155600000000000000001555
02222222000000000000000001111111000000000000000000000000000000000000000000000000000000000000000000000000156500000000000000001556
00500050000000000000000000500050000000000000000000000000000000000000000000000000000000000000000000000000155500000000000000001556
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000155500000000000000001565
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000156500000000000000001565
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000155600000000000000001655
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000155500000000000000001555
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000156556555565556555655565
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000165556555565556555655565
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000155565555655565556555655
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111111111111
__gff__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101000101010000000000010101010000010000000000000000000100010000000000000000000000000001010100000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
4d4e4e4e4e4e4e4e4e4e4e4e4e4e4e4f10101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5d11400000404141424600001140125f10003800002c00000000000000360010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5d00500000501222500000000050005f10003a00003900003800000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5d00000000000000000000000000005f10000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5d00000000000045000000000000005f10000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5d00000040414142000000430000005f100000003a003a1c0000003900000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5d00000040122250000000432000005f10000000390000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5d00001140000000000046530000475f10000000000000000000003700002c10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5d00000040120000000000000000005f100000003a0000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5d00004650000000000000000000005f10000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5d00000000000000002140000040125f100000000000000000003800003a0010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5d00000000000000005041000050415f1000000000000000003a000000003710000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5d00000000000000000000000000005f10000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5d00114021000000000000000000215f10000038000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5d00005041411200000047000000505f1000003b3a39000000001c0000003710000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6d6e6e6e6e6e6e6e6e6e6e6e6e6e6e6f10101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
